#include <iostream>
#include <vector>
#include <array>
#include <set>
#include <map>
#include <tuple>
#include <numeric>
#include <algorithm>

#ifdef NDEBUG
#undef NDEBUG
#endif

#include <assert.h>

#define ASSERT_EQ(a, b) \
   do { __typeof__ (a) _a = (a); \
       __typeof__ (b) _b = (b); \
     if (_a != _b)       \
     {                 \
       std::cout << _a << " != " << _b << std::endl; \
       assert(0);                  \
     }                  \
     }while(0)

namespace {
/*
        [F] [Q]         [Q]
[B]     [Q] [V] [D]     [S]
[S] [P] [T] [R] [M]     [D]
[J] [V] [W] [M] [F]     [J]     [J]
[Z] [G] [S] [W] [N] [D] [R]     [T]
[V] [M] [B] [G] [S] [C] [T] [V] [S]
[D] [S] [L] [J] [L] [G] [G] [F] [R]
[G] [Z] [C] [H] [C] [R] [H] [P] [D]

 *
 */

    std::vector<std::vector<char>> input{
            {0,   0,   'F', 'Q', 0,   0,   'Q', 0,   0,},
            {'B', 0,   'Q', 'V', 'D', 0,   'S', 0,   0,},
            {'S', 'P', 'T', 'R', 'M', 0,   'D', 0,   0,},
            {'J', 'V', 'W', 'M', 'F', 0,   'J', 0,   'J',},
            {'Z', 'G', 'S', 'W', 'N', 'D', 'R', 0,   'T',},
            {'V', 'M', 'B', 'G', 'S', 'C', 'T', 'V', 'S',},
            {'D', 'S', 'L', 'J', 'L', 'G', 'G', 'F', 'R',},
            {'G', 'Z', 'C', 'H', 'C', 'R', 'H', 'P', 'D',},
    };

    std::vector<std::tuple<int64_t, int64_t, int64_t>> input_steps{
            {3,  5, 2},
            {3,  8, 4},
            {7,  7, 3},
            {14, 3, 9},
            {8,  4, 1},
            {1,  7, 5},
            {2,  6, 4},
            {4,  5, 7},
            {1,  3, 6},
            {3,  4, 3},
            {1,  4, 1},
            {5,  1, 9},
            {1,  4, 6},
            {4,  7, 4},
            {15, 9, 2},
            {7,  1, 6},
            {3,  3, 5},
            {1,  4, 9},
            {2,  5, 3},
            {2,  4, 9},
            {4,  1, 6},
            {1,  3, 1},
            {1,  3, 2},
            {4,  6, 3},
            {24, 2, 8},
            {4,  9, 8},
            {1,  1, 3},
            {2,  5, 4},
            {1,  2, 4},
            {19, 8, 1},
            {5,  3, 9},
            {8,  1, 3},
            {3,  4, 1},
            {6,  9, 5},
            {2,  3, 4},
            {1,  8, 5},
            {2,  4, 6},
            {11, 6, 1},
            {8,  8, 7},
            {1,  6, 5},
            {13, 1, 3},
            {1,  1, 7},
            {2,  7, 8},
            {5,  7, 1},
            {2,  8, 4},
            {3,  5, 3},
            {11, 3, 1},
            {2,  5, 3},
            {2,  5, 3},
            {2,  7, 1},
            {7,  3, 1},
            {1,  4, 5},
            {1,  6, 4},
            {3,  4, 7},
            {3,  7, 1},
            {6,  3, 5},
            {1,  5, 9},
            {4,  5, 4},
            {2,  3, 4},
            {8,  9, 2},
            {5,  4, 6},
            {1,  6, 5},
            {1,  4, 9},
            {39, 1, 7},
            {7,  2, 6},
            {1,  9, 3},
            {1,  2, 7},
            {1,  3, 1},
            {5,  7, 3},
            {4,  5, 1},
            {19, 7, 9},
            {1,  9, 8},
            {1,  9, 7},
            {5,  9, 3},
            {6,  6, 7},
            {1,  8, 3},
            {4,  1, 4},
            {23, 7, 6},
            {1,  1, 6},
            {21, 6, 2},
            {3,  4, 8},
            {7,  6, 1},
            {1,  4, 9},
            {1,  6, 7},
            {6,  1, 2},
            {1,  7, 4},
            {15, 2, 8},
            {5,  3, 8},
            {22, 8, 7},
            {1,  8, 1},
            {5,  3, 4},
            {1,  3, 2},
            {1,  1, 2},
            {3,  4, 8},
            {3,  8, 9},
            {11, 2, 1},
            {2,  1, 4},
            {15, 9, 5},
            {22, 7, 3},
            {2,  4, 9},
            {3,  4, 2},
            {8,  1, 8},
            {6,  8, 6},
            {1,  6, 2},
            {3,  6, 9},
            {3,  2, 7},
            {4,  2, 9},
            {2,  7, 5},
            {1,  1, 7},
            {2,  8, 2},
            {2,  7, 5},
            {9,  5, 3},
            {8,  5, 2},
            {1,  6, 4},
            {1,  6, 9},
            {1,  2, 9},
            {2,  5, 1},
            {7,  2, 3},
            {1,  4, 3},
            {1,  2, 4},
            {5,  3, 4},
            {6,  9, 3},
            {1,  2, 6},
            {6,  9, 6},
            {2,  1, 8},
            {3,  6, 3},
            {2,  8, 6},
            {6,  4, 1},
            {14, 3, 9},
            {1,  6, 4},
            {3,  3, 9},
            {1,  4, 5},
            {10, 9, 6},
            {6,  6, 7},
            {2,  1, 8},
            {1,  8, 6},
            {16, 3, 2},
            {1,  8, 1},
            {1,  7, 1},
            {7,  3, 4},
            {1,  6, 5},
            {4,  2, 3},
            {5,  4, 9},
            {2,  4, 5},
            {4,  7, 4},
            {5,  9, 6},
            {2,  5, 4},
            {11, 6, 7},
            {1,  6, 8},
            {5,  1, 5},
            {2,  6, 4},
            {7,  7, 3},
            {1,  8, 6},
            {2,  7, 3},
            {1,  1, 3},
            {3,  2, 8},
            {9,  2, 5},
            {1,  6, 1},
            {1,  4, 8},
            {7,  4, 7},
            {8,  5, 6},
            {1,  7, 2},
            {1,  7, 4},
            {3,  7, 8},
            {1,  2, 3},
            {1,  1, 2},
            {1,  1, 7},
            {3,  7, 6},
            {11, 6, 2},
            {4,  8, 7},
            {2,  8, 7},
            {15, 3, 2},
            {7,  9, 4},
            {3,  3, 2},
            {4,  4, 7},
            {5,  7, 3},
            {3,  4, 6},
            {3,  6, 9},
            {1,  4, 2},
            {1,  8, 1},
            {2,  3, 7},
            {2,  3, 7},
            {23, 2, 5},
            {1,  9, 1},
            {1,  7, 9},
            {1,  1, 8},
            {8,  7, 1},
            {1,  8, 4},
            {1,  4, 2},
            {3,  9, 8},
            {1,  7, 9},
            {22, 5, 9},
            {1,  8, 5},
            {1,  7, 4},
            {1,  4, 5},
            {1,  8, 3},
            {2,  9, 3},
            {5,  5, 2},
            {5,  5, 4},
            {3,  2, 7},
            {1,  7, 3},
            {6,  1, 7},
            {4,  3, 1},
            {6,  2, 8},
            {1,  5, 6},
            {2,  8, 1},
            {12, 9, 4},
            {8,  9, 4},
            {1,  2, 9},
            {2,  9, 8},
            {3,  2, 8},
            {5,  8, 6},
            {7,  7, 1},
            {4,  8, 9},
            {1,  6, 1},
            {17, 4, 7},
            {1,  2, 4},
            {2,  4, 1},
            {6,  4, 6},
            {1,  1, 4},
            {7,  1, 5},
            {9,  7, 9},
            {8,  9, 8},
            {5,  8, 3},
            {1,  5, 6},
            {2,  3, 6},
            {1,  9, 1},
            {1,  6, 1},
            {10, 6, 1},
            {1,  5, 1},
            {2,  9, 1},
            {1,  9, 7},
            {2,  6, 8},
            {2,  8, 2},
            {1,  6, 8},
            {22, 1, 9},
            {9,  7, 5},
            {1,  8, 1},
            {2,  8, 3},
            {4,  5, 9},
            {1,  8, 3},
            {5,  1, 9},
            {2,  7, 3},
            {2,  4, 7},
            {1,  8, 5},
            {2,  2, 4},
            {1,  5, 8},
            {9,  5, 8},
            {2,  7, 5},
            {2,  4, 5},
            {3,  8, 4},
            {3,  4, 3},
            {2,  8, 6},
            {1,  6, 4},
            {3,  5, 9},
            {1,  6, 3},
            {12, 3, 5},
            {1,  3, 1},
            {7,  5, 4},
            {1,  1, 3},
            {1,  8, 1},
            {7,  5, 1},
            {6,  9, 6},
            {29, 9, 5},
            {2,  4, 6},
            {26, 5, 2},
            {24, 2, 7},
            {1,  3, 2},
            {8,  1, 7},
            {7,  6, 9},
            {2,  5, 3},
            {1,  6, 4},
            {3,  8, 5},
            {2,  3, 8},
            {2,  2, 8},
            {5,  9, 2},
            {27, 7, 2},
            {2,  8, 3},
            {2,  9, 5},
            {3,  8, 5},
            {2,  7, 4},
            {3,  4, 7},
            {2,  3, 2},
            {4,  5, 1},
            {5,  7, 2},
            {29, 2, 8},
            {9,  8, 3},
            {2,  4, 8},
            {7,  3, 2},
            {3,  5, 4},
            {1,  7, 5},
            {3,  5, 6},
            {2,  1, 8},
            {2,  6, 8},
            {3,  4, 2},
            {4,  4, 2},
            {1,  6, 8},
            {8,  2, 4},
            {2,  3, 5},
            {1,  4, 1},
            {3,  1, 2},
            {4,  8, 2},
            {3,  4, 9},
            {3,  4, 1},
            {2,  9, 5},
            {1,  4, 6},
            {4,  5, 1},
            {1,  6, 8},
            {1,  9, 3},
            {4,  2, 3},
            {15, 8, 2},
            {9,  8, 1},
            {1,  3, 9},
            {5,  1, 9},
            {3,  9, 7},
            {2,  7, 6},
            {3,  3, 2},
            {1,  7, 8},
            {1,  9, 6},
            {1,  9, 8},
            {2,  8, 2},
            {1,  1, 2},
            {1,  3, 7},
            {4,  1, 7},
            {19, 2, 5},
            {1,  1, 4},
            {1,  7, 4},
            {1,  1, 5},
            {3,  1, 4},
            {1,  1, 8},
            {6,  2, 4},
            {7,  2, 1},
            {2,  7, 9},
            {8,  2, 8},
            {2,  7, 3},
            {1,  6, 4},
            {10, 4, 6},
            {5,  6, 7},
            {2,  9, 8},
            {6,  8, 9},
            {1,  2, 3},
            {2,  8, 3},
            {5,  1, 8},
            {8,  5, 2},
            {8,  8, 7},
            {7,  2, 8},
            {1,  1, 2},
            {1,  9, 7},
            {1,  4, 2},
            {2,  2, 6},
            {5,  9, 3},
            {2,  8, 6},
            {2,  3, 9},
            {4,  8, 6},
            {7,  6, 1},
            {8,  1, 5},
            {1,  8, 7},
            {1,  9, 6},
            {12, 5, 3},
            {1,  4, 8},
            {2,  9, 5},
            {1,  2, 3},
            {3,  5, 1},
            {1,  1, 5},
            {21, 3, 8},
            {2,  1, 5},
            {6,  5, 7},
            {2,  5, 6},
            {10, 6, 9},
            {1,  6, 8},
            {13, 8, 2},
            {2,  5, 4},
            {2,  4, 3},
            {4,  9, 1},
            {5,  7, 8},
            {12, 8, 1},
            {5,  9, 6},
            {1,  3, 7},
            {2,  6, 5},
            {11, 2, 1},
            {1,  8, 4},
            {16, 1, 9},
            {1,  2, 6},
            {1,  8, 5},
            {12, 9, 3},
            {14, 7, 2},
            {1,  7, 9},
            {1,  4, 2},
            {1,  7, 5},
            {3,  9, 5},
            {4,  6, 9},
            {3,  9, 4},
            {1,  8, 4},
            {2,  4, 5},
            {1,  7, 1},
            {5,  3, 5},
            {2,  4, 2},
            {8,  2, 7},
            {7,  2, 4},
            {1,  3, 7},
            {3,  9, 7},
            {2,  2, 9},
            {3,  4, 5},
            {6,  1, 8},
            {6,  1, 5},
            {3,  9, 2},
            {22, 5, 9},
            {1,  5, 6},
            {2,  2, 3},
            {5,  7, 6},
            {5,  8, 9},
            {2,  7, 2},
            {20, 9, 4},
            {1,  8, 3},
            {2,  2, 5},
            {1,  2, 5},
            {15, 4, 8},
            {1,  5, 7},
            {6,  9, 1},
            {5,  4, 8},
            {2,  4, 8},
            {1,  2, 1},
            {5,  6, 5},
            {5,  5, 7},
            {1,  9, 8},
            {5,  7, 2},
            {2,  5, 1},
            {4,  7, 5},
            {1,  5, 9},
            {1,  6, 8},
            {1,  7, 2},
            {6,  3, 4},
            {3,  5, 7},
            {1,  9, 2},
            {6,  2, 3},
            {1,  3, 4},
            {13, 8, 9},
            {7,  1, 5},
            {6,  9, 2},
            {1,  1, 4},
            {6,  2, 3},
            {1,  1, 4},
            {5,  9, 7},
            {11, 8, 4},
            {7,  7, 3},
            {2,  7, 8},
            {1,  8, 2},
            {8,  4, 1},
            {2,  1, 6},
            {2,  5, 8},
            {3,  1, 9},
            {1,  8, 2},
            {11, 3, 2},
            {2,  8, 9},
            {9,  4, 7},
            {11, 3, 8},
            {7,  9, 6},
            {5,  4, 6},
            {3,  7, 3},
            {1,  7, 1},
            {5,  7, 6},
            {2,  3, 5},
            {1,  3, 4},
            {5,  2, 5},
            {1,  1, 7},
            {1,  4, 8},
            {1,  7, 6},
            {7,  5, 7},
            {2,  5, 7},
            {3,  1, 7},
            {1,  2, 3},
            {1,  6, 4},
            {1,  3, 4},
            {1,  5, 3},
            {18, 6, 4},
            {9,  7, 1},
            {14, 4, 6},
            {3,  6, 4},
            {12, 6, 7},
            {2,  5, 3},
            {3,  7, 4},
            {6,  4, 7},
            {5,  1, 7},
            {5,  4, 5},
            {5,  2, 1},
            {9,  8, 4},
            {9,  1, 3},
            {2,  8, 2},
            {4,  2, 4},
            {1,  7, 6},
            {1,  2, 3},
            {1,  8, 9},
            {1,  6, 9},
            {2,  9, 3},
            {3,  4, 1},
            {13, 3, 5},
            {12, 5, 1},
            {7,  1, 8},
            {1,  3, 6},
            {4,  5, 4},
            {1,  5, 2},
            {8,  4, 9},
    };

}

int _5(int64_t part) {
    std::vector<std::vector<char>> stacks(9);

    for (int64_t s = 0; s < 9; s++) {
        for (int64_t r = 0; r < 8; r++) {
            char crate = input[7 - r][s];
            if (crate != 0) {
                stacks[s].push_back(crate);
            }
        }
    }

    for (int64_t s = 0; s < 9; s++) {
        std::cout << s << " : ";
        for (auto crate: stacks[s]) {
            std::cout << crate;
        }
        std::cout << std::endl;
    }

    if (part == 1) {
        for (auto [how_many, from, to]: input_steps) {
            for (int64_t i = 0; i < how_many; i++) {
                assert(!stacks[from - 1].empty());
                auto crate = stacks[from - 1].back();
                stacks[from - 1].pop_back();
                stacks[to - 1].push_back(crate);

            }
        }
    } else {
        for (auto [how_many, from, to]: input_steps) {
            std::vector<char> tmp;
            for (int64_t i = 0; i < how_many; i++) {
                assert(!stacks[from - 1].empty());
                auto crate = stacks[from - 1].back();
                stacks[from - 1].pop_back();
                tmp.insert(tmp.begin(), crate);
            }
            stacks[to - 1].insert(stacks[to - 1].end(), tmp.begin(), tmp.end());
        }
    }


    for (auto [how_many, from, to]: input_steps) {

        std::vector<char> tmp;
        for (int64_t i = 0; i < how_many; i++) {
            assert(!stacks[from - 1].empty());
            auto crate = stacks[from - 1].back();
            stacks[from - 1].pop_back();
            tmp.insert(tmp.begin(), crate);
        }
        stacks[to - 1].insert(stacks[to - 1].end(), tmp.begin(), tmp.end());
    }

    for (int64_t s = 0; s < 9; s++) {
        assert(!stacks[s].empty());
        std::cout << stacks[s].back();
    }

    std::cout << std::endl;

    return 0;
}
